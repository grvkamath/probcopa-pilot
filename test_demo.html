<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Demonstrations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://proliferate.alps.science/static/js/proliferate.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            background-color: #f9f9f9;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .progress {
            margin-bottom: 20px;
            font-weight: bold;
            color: #666;
        }
        
        .question-container {
            margin-bottom: 30px;
        }
        
        .information {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .alternatives {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #ff9800;
        }
        
        .instruction {
            background-color: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #9c27b0;
        }
        
        .choice-container {
            margin: 30px 0;
            text-align: center;
        }
        
        .choice-context {
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .choice-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background-color: #f0f0f0;
            color: #333;
            padding: 15px 25px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
            text-align: left;
        }
        
        .choice-btn:hover {
            background-color: #e0e0e0;
            border-color: #2196f3;
        }
        
        .choice-btn.selected {
            background-color: #2196f3;
            color: white;
            border-color: #2196f3;
        }
        
        .confidence-container {
            margin: 30px 0;
            text-align: center;
        }
        
        .confidence-labels {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
        
        .confidence-slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .confidence-slider-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .confidence-value {
            font-size: 18px;
            font-weight: bold;
            color: #ff9800;
            margin: 10px 0;
        }
        
        .continue-btn {
            background-color: #4caf50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .continue-btn:hover {
            background-color: #45a049;
        }
        
        .continue-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .completion-message {
            text-align: center;
            font-size: 18px;
            color: #4caf50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Demonstrations</h1>
        
        <div id="experiment-container">
            <div class="progress" id="progress"></div>
            
            <div class="question-container">
                <div class="information" id="information"></div>
                <div class="alternatives" id="alternatives"></div>
                <div class="instruction" id="instruction"></div>
            </div>
            
            <div class="choice-container">
                <div class="choice-context" id="choice-context"></div>
                <div class="choice-buttons">
                    <button class="choice-btn" id="choice-1">Choice 1</button>
                    <button class="choice-btn" id="choice-2">Choice 2</button>
                </div>
            </div>

            <div class="confidence-container">
                <div class="confidence-labels">
                    <span>Not at all confident</span>
                    <span>Very confident</span>
                </div>
                <div class="confidence-slider-container">
                    <div class="confidence-slider-wrapper">
                        <input type="range" id="confidence-slider" min="0" max="100" value="50" step="1">
                        <div class="confidence-value" id="confidence-value">50</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="continue-btn" id="continue-btn">Continue</button>
            </div>
        </div>
        
        <div id="transition-container" style="display: none;">
            <div class="completion-message">
                <h2>Practice Complete!</h2>
                <p>Great job! You've completed the practice examples.</p>
                <button class="continue-btn" onclick="console.log('Test completed!')">Finish Test</button>
            </div>
        </div>
    </div>

    <script>
        // Test data - just the instructional examples
        const COPA_DATA = [[]]; // Empty array to avoid loading issues
        
        // Global variables
        let currentData = [];
        let currentIndex = 0;
        let responses = [];
        let experimentStartTime = null;
        let attentionChecks = [];
        let attentionCheckResults = [];
        let isInstructionPhase = true;
        let instructionIndex = 0;
        let isWelcomePhase = false; // Skip welcome for testing
        let isConsentPhase = false;
        let consentData = {};
        let selectedChoice = null;
        let confidenceLevel = 50;

        // Instructional examples for practice
        const INSTRUCTIONAL_EXAMPLES = [
            {
                id: "instruction_1",
                "asks-for": "cause",
                "most-plausible-alternative": 1,
                p: "The ice cream melted.",
                a1: "The sun was hot.",
                a2: "The ice cream was chocolate flavored."
            },
            {
                id: "instruction_2",
                "asks-for": "effect", 
                "most-plausible-alternative": 2,
                p: "The student studied for 10 hours.",
                a1: "The student went to the library.",
                a2: "The student got an A on the exam."
            },
            {
                id: "instruction_3",
                "asks-for": "cause",
                "most-plausible-alternative": 0, // 0 indicates both options are equally plausible
                p: "The man went to the store.",
                a1: "He wanted to buy some food.",
                a2: "He wanted to buy something to drink."
            }
        ];

        // Display instructional example
        function displayInstructionExample() {
            if (instructionIndex >= INSTRUCTIONAL_EXAMPLES.length) {
                // Instructions completed, show transition message
                document.getElementById('experiment-container').style.display = 'none';
                document.getElementById('transition-container').style.display = 'block';
                return;
            }
            
            const example = INSTRUCTIONAL_EXAMPLES[instructionIndex];
            
            // Update progress
            document.getElementById('progress').textContent = 
                `Practice Example ${instructionIndex + 1} of ${INSTRUCTIONAL_EXAMPLES.length}`;
            
            // Display information
            document.getElementById('information').innerHTML = 
                `<strong>Situation:</strong> ${example.p}`;
            
            // Display alternatives
            document.getElementById('alternatives').innerHTML = 
                `<strong>There are two possible <mark>${example['asks-for']}s</mark> of this situation:</strong><br>
                (1) ${example.a1}<br>
                (2) ${example.a2}`;
            
            // Display instruction
            document.getElementById('instruction').innerHTML = 
                `<strong>This is a practice example. First, choose which <mark>${example['asks-for']}</mark> you think is more likely, then rate your confidence in that choice.</strong><br>
                Click on one of the options below, then use the confidence slider to indicate how certain you are about your choice.`;
            
            // Update choice context
            const contextText = example['asks-for'] === 'effect' ? 
                `${example.p} <strong>As a result...</strong>` : 
                `${example.p} <strong>This is because...</strong>`;
            document.getElementById('choice-context').innerHTML = contextText;
            
            // Update choice buttons
            document.getElementById('choice-1').innerHTML = `<strong>(1)</strong> ${example.a1}`;
            document.getElementById('choice-2').innerHTML = `<strong>(2)</strong> ${example.a2}`;
            
            // Reset choice and confidence
            selectedChoice = null;
            confidenceLevel = 50;
            document.getElementById('confidence-slider').value = 50;
            document.getElementById('confidence-value').textContent = '50';
            
            // Reset button states
            document.getElementById('choice-1').classList.remove('selected');
            document.getElementById('choice-2').classList.remove('selected');
            
            // Disable continue button until choice is made
            document.getElementById('continue-btn').disabled = true;
        }

        // Handle instructional example response
        function handleInstructionResponse(choice, confidence) {
            const example = INSTRUCTIONAL_EXAMPLES[instructionIndex];
            let isChoiceCorrect = false;
            let isConfidenceAppropriate = false;
            
            // Check if choice is correct based on most-plausible-alternative
            if (example['most-plausible-alternative'] === 1) {
                // Option 1 is correct
                isChoiceCorrect = choice === 1;
            } else if (example['most-plausible-alternative'] === 2) {
                // Option 2 is correct
                isChoiceCorrect = choice === 2;
            } else if (example['most-plausible-alternative'] === 0) {
                // Both options are equally plausible - either choice is acceptable
                isChoiceCorrect = choice === 1 || choice === 2;
            }
            
            // Check if confidence is appropriate
            if (example['most-plausible-alternative'] === 1 || example['most-plausible-alternative'] === 2) {
                // For clear cases, confidence should be reasonably high (at least 70)
                isConfidenceAppropriate = confidence >= 70;
            } else if (example['most-plausible-alternative'] === 0) {
                // For ambiguous cases, confidence should be moderate (below 50)
                isConfidenceAppropriate = confidence < 50;
            }
            
            console.log(`Example ${instructionIndex + 1}: choice=${choice}, confidence=${confidence}, choiceCorrect=${isChoiceCorrect}, confidenceAppropriate=${isConfidenceAppropriate}, expected=${example['most-plausible-alternative']}`);
            
            if (isChoiceCorrect && isConfidenceAppropriate) {
                // Both choice and confidence are correct - move to next example
                instructionIndex++;
                displayInstructionExample();
            } else {
                // Show feedback for incorrect choice or inappropriate confidence
                showInstructionFeedback(example, choice, confidence, isChoiceCorrect, isConfidenceAppropriate);
            }
        }

        // Show feedback for incorrect instructional response
        function showInstructionFeedback(example, choice, confidence, isChoiceCorrect, isConfidenceAppropriate) {
            const correctOption = example['most-plausible-alternative'];
            
            let feedbackText = '';
            
            // Check choice feedback
            if (!isChoiceCorrect) {
                if (correctOption === 0) {
                    // Both options are equally plausible
                    feedbackText += `<strong style="color: #f44336;">Incorrect choice.</strong><br>
                    Both options are equally plausible in this case.<br>
                    Either choice (1) or (2) would be acceptable.<br>`;
                } else {
                    // One option is more plausible
                    const correctText = correctOption === 1 ? example.a1 : example.a2;
                    feedbackText += `<strong style="color: #f44336;">Incorrect choice.</strong><br>
                    The most likely ${example['asks-for']} is: <strong>${correctText}</strong><br>
                    You should have selected option (${correctOption}).<br>`;
                }
            }
            
            // Check confidence feedback
            if (!isConfidenceAppropriate) {
                if (correctOption === 1 || correctOption === 2) {
                    // For clear cases, confidence should be high
                    feedbackText += `<strong style="color: #ff9800;">Inappropriate confidence level.</strong><br>
                    Since this is a clear case where one option is much more likely, your confidence should be higher; move the slider to a higher value to continue.<br>`;
                } else if (correctOption === 0) {
                    // For ambiguous cases, confidence should be moderate
                    if (confidence > 50) {
                        feedbackText += `<strong style="color: #ff9800;">Inappropriate confidence level.</strong><br>
                        Since both options are equally plausible, your confidence in any single option should be lower. Try moving the slider to a lower value to continue.<br>`;
                    } 
                }
            }
            
            // Add instruction for correction
            if (!isChoiceCorrect && !isConfidenceAppropriate) {
                feedbackText += `<br>Please correct both your choice and confidence level to continue.`;
            } else if (!isChoiceCorrect) {
                feedbackText += `<br>Please correct your choice to continue.`;
            } else if (!isConfidenceAppropriate) {
                feedbackText += `<br>Please adjust your confidence level to continue.`;
            }
            
            document.getElementById('instruction').innerHTML = feedbackText;
            
            // Keep continue button enabled - user can always click to try again
            document.getElementById('continue-btn').disabled = false;
        }

        // Handle confidence slider value change
        function updateConfidenceValue() {
            const slider = document.getElementById('confidence-slider');
            const valueDisplay = document.getElementById('confidence-value');
            confidenceLevel = parseInt(slider.value);
            valueDisplay.textContent = confidenceLevel;
            
            // Enable continue button when slider is moved (always allow clicking)
            if (selectedChoice !== null) {
                document.getElementById('continue-btn').disabled = false;
            }
        }

        // Handle choice button selection
        function selectChoice(choice) {
            selectedChoice = choice;
            
            // Update button states
            document.getElementById('choice-1').classList.remove('selected');
            document.getElementById('choice-2').classList.remove('selected');
            document.getElementById(`choice-${choice}`).classList.add('selected');
            
            // Enable continue button (always allow clicking)
            document.getElementById('continue-btn').disabled = false;
        }

        // Handle continue button click
        function continueToNext() {
            if (isInstructionPhase) {
                handleInstructionResponse(selectedChoice, confidenceLevel);
                return;
            }
        }

        // Initialize the test
        function initTest() {
            experimentStartTime = Date.now();
            displayInstructionExample();
            
            // Add event listeners
            document.getElementById('confidence-slider').addEventListener('input', updateConfidenceValue);
            document.getElementById('choice-1').addEventListener('click', () => selectChoice(1));
            document.getElementById('choice-2').addEventListener('click', () => selectChoice(2));
            document.getElementById('continue-btn').addEventListener('click', continueToNext);
        }

        // Start the test when page loads
        document.addEventListener('DOMContentLoaded', initTest);
    </script>
</body>
</html> 